<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡¶ß‡ßç‡¶Ø‡¶Ø‡¶º‡¶® ‡¶∏‡¶ô‡ßç‡¶ò - Real-Time AI Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .bengali-title { font-family: 'Noto Sans Bengali', sans-serif; }
        .metric-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .progress-ring {
            width: 80px;
            height: 80px;
            margin: 0 auto;
        }
        .progress-ring-circle {
            transition: stroke-dasharray 0.5s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .streak-badge {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border-radius: 20px;
            padding: 10px 20px;
            font-weight: bold;
            text-align: center;
        }
        .ai-insight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }
        .recommendation-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .recommendation-card:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .real-time-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand bengali-title" href="#">
                <i class="fas fa-brain me-2"></i>
                ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶Ø‡¶º‡¶® ‡¶∏‡¶ô‡ßç‡¶ò - AI Assistant
                <span class="real-time-indicator"></span>
            </a>
            <button class="btn btn-outline-light btn-sm" id="refreshData">
                <i class="fas fa-sync-alt me-1"></i>Update Now
            </button>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Real-Time Metrics Header -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="bengali-title mb-3">Your Personalized AI Study Assistant</h2>
                <div class="alert alert-info">
                    <i class="fas fa-robot me-2"></i>
                    AI insights update in real-time based on your study activity
                    <span id="lastUpdated" class="float-end small"></span>
                </div>
            </div>
        </div>

        <!-- Main Metrics Dashboard -->
        <div class="row mb-4">
            <!-- Study Efficiency -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card metric-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="progress-ring mb-3">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring-circle"
                                        stroke="#007bff"
                                        stroke-width="6"
                                        fill="transparent"
                                        r="35"
                                        cx="40"
                                        cy="40"
                                        id="efficiencyCircle"/>
                            </svg>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                <h4 id="efficiencyValue" class="mb-0">75%</h4>
                            </div>
                        </div>
                        <h6 class="card-title">Study Efficiency</h6>
                        <p id="efficiencyTrend" class="text-success small">
                            <i class="fas fa-arrow-up me-1"></i>Improving
                        </p>
                    </div>
                </div>
            </div>

            <!-- Goals Completed -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card metric-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-4 text-warning mb-2">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h2 id="goalsValue" class="card-title mb-0">0</h2>
                        <h6 class="card-subtitle text-muted">Goals Completed</h6>
                        <p class="text-muted small mb-0">This month</p>
                    </div>
                </div>
            </div>

            <!-- Study Hours -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card metric-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="display-4 text-info mb-2">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h2 id="hoursValue" class="card-title mb-0">0h</h2>
                        <h6 class="card-subtitle text-muted">Study Hours</h6>
                        <p class="text-muted small mb-0">This week</p>
                    </div>
                </div>
            </div>

            <!-- Day Streak -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card metric-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="streak-badge mb-2">
                            <div class="display-6">üî•</div>
                            <h2 id="streakValue" class="mb-0">1</h2>
                        </div>
                        <h6 class="card-subtitle text-muted">Day Streak</h6>
                        <p id="streakMessage" class="text-success small mb-0">Keep going!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights Section -->
        <div class="row">
            <!-- AI Recommendations -->
            <div class="col-lg-8 mb-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="fas fa-robot text-primary me-2"></i>
                            AI Recommendations
                            <span class="badge bg-primary ms-2">Real-time</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="aiRecommendations">
                            <!-- Dynamic recommendations will load here -->
                            <div class="text-center py-3">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading AI insights...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Insights -->
            <div class="col-lg-4 mb-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            Personal Insights
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Motivational Message -->
                        <div class="ai-insight mb-3">
                            <h6><i class="fas fa-heart me-2"></i>Motivation</h6>
                            <p id="motivationalMessage" class="mb-0">Loading your personalized message...</p>
                        </div>

                        <!-- Focus Score -->
                        <div class="mb-3">
                            <label class="form-label small text-muted">Focus Score</label>
                            <div class="progress mb-1" style="height: 8px;">
                                <div id="focusProgressBar" class="progress-bar bg-success" style="width: 68%"></div>
                            </div>
                            <small id="focusScore" class="text-muted">68/100</small>
                        </div>

                        <!-- Learning Velocity -->
                        <div class="mb-3">
                            <label class="form-label small text-muted">Learning Velocity</label>
                            <div class="progress mb-1" style="height: 8px;">
                                <div id="velocityProgressBar" class="progress-bar bg-info" style="width: 45%"></div>
                            </div>
                            <small id="learningVelocity" class="text-muted">45/100</small>
                        </div>

                        <!-- Preferred Study Time -->
                        <div class="text-center mt-3">
                            <small class="text-muted">Best Study Time</small>
                            <div id="preferredTime" class="fw-bold">Morning</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Next Goals Section -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="fas fa-target text-success me-2"></i>
                            Your Next Goals
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="nextGoals" class="row">
                            <!-- Dynamic goals will load here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class RealTimeAIDashboard {
            constructor() {
                this.lastUpdateTime = null;
                this.updateInterval = null;
                this.init();
            }

            init() {
                this.loadDashboardData();
                this.setupEventListeners();
                this.startRealTimeUpdates();
            }

            setupEventListeners() {
                document.getElementById('refreshData').addEventListener('click', () => {
                    this.loadDashboardData(true);
                });

                // Listen for session completion events
                document.addEventListener('sessionCompleted', () => {
                    this.loadDashboardData();
                });
            }

            startRealTimeUpdates() {
                // Update every 30 seconds
                this.updateInterval = setInterval(() => {
                    this.loadDashboardData();
                }, 30000);
            }

            async loadDashboardData(showLoader = false) {
                if (showLoader) {
                    this.showLoadingState();
                }

                try {
                    const response = await fetch('/api/analytics/dashboard');
                    const data = await response.json();

                    this.updateMetrics(data);
                    this.updateRecommendations(data.recommendations || []);
                    this.updateInsights(data);
                    this.updateLastUpdatedTime();

                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    this.showErrorState();
                }
            }

            updateMetrics(data) {
                // Update Study Efficiency
                const efficiency = Math.round(data.efficiency || 75);
                document.getElementById('efficiencyValue').textContent = efficiency + '%';
                this.updateProgressRing('efficiencyCircle', efficiency);

                // Update Goals Completed
                document.getElementById('goalsValue').textContent = data.goalsCompleted || 0;

                // Update Study Hours
                const hours = (data.studyHoursWeek || 0).toFixed(1);
                document.getElementById('hoursValue').textContent = hours + 'h';

                // Update Day Streak
                const streak = data.dayStreak || 1;
                document.getElementById('streakValue').textContent = streak;

                // Update streak message
                const streakMsg = streak > 7 ? 'Amazing streak! üî•' :
                                 streak > 3 ? 'Great momentum!' :
                                 streak > 0 ? 'Keep going!' : 'Start today!';
                document.getElementById('streakMessage').textContent = streakMsg;

                // Update Focus Score
                const focusScore = Math.round(data.focusScore || 68);
                document.getElementById('focusScore').textContent = focusScore + '/100';
                document.getElementById('focusProgressBar').style.width = focusScore + '%';

                // Update Learning Velocity
                const velocity = Math.round(data.learningVelocity || 45);
                document.getElementById('learningVelocity').textContent = velocity + '/100';
                document.getElementById('velocityProgressBar').style.width = velocity + '%';

                // Update Preferred Time
                document.getElementById('preferredTime').textContent = data.preferredStudyTime || 'Morning';
            }

            updateProgressRing(elementId, percentage) {
                const circle = document.getElementById(elementId);
                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (percentage / 100) * circumference;

                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;
            }

            updateRecommendations(recommendations) {
                const container = document.getElementById('aiRecommendations');

                if (!recommendations || recommendations.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-robot fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No specific recommendations right now. Keep up the good work!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = recommendations.map(rec => `
                    <div class="recommendation-card">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fas fa-lightbulb text-warning fa-lg"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="fw-bold mb-2">${rec.title}</h6>
                                <p class="mb-2 text-muted">${rec.description}</p>
                                <span class="badge bg-${rec.priority === 'High' ? 'danger' : rec.priority === 'Medium' ? 'warning' : 'info'}">
                                    ${rec.priority} Priority
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            updateInsights(data) {
                // Update motivational message
                const message = data.motivationalMessage || "Every expert was once a beginner. You've got this! üí™";
                document.getElementById('motivationalMessage').textContent = message;

                // Update next goals
                const goalsContainer = document.getElementById('nextGoals');
                const goals = data.nextGoals || [];

                goalsContainer.innerHTML = goals.map((goal, index) => `
                    <div class="col-md-6 mb-2">
                        <div class="d-flex align-items-center p-2 bg-light rounded">
                            <div class="me-2">
                                <i class="fas fa-target text-success"></i>
                            </div>
                            <small>${goal}</small>
                        </div>
                    </div>
                `).join('');
            }

            updateLastUpdatedTime() {
                this.lastUpdateTime = new Date();
                document.getElementById('lastUpdated').textContent =
                    'Last updated: ' + this.lastUpdateTime.toLocaleTimeString();
            }

            showLoadingState() {
                document.getElementById('aiRecommendations').innerHTML = `
                    <div class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Updating AI insights...</span>
                        </div>
                    </div>
                `;
            }

            showErrorState() {
                document.getElementById('aiRecommendations').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Unable to load real-time data. Using cached insights.
                    </div>
                `;
            }

            // Method to trigger when user completes a session
            onSessionCompleted(sessionData) {
                fetch('/api/analytics/session-completed', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sessionData)
                }).then(() => {
                    this.loadDashboardData();
                });
            }
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.aiDashboard = new RealTimeAIDashboard();
        });

        // Simulate session completion for demo
        function simulateSessionCompletion() {
            if (window.aiDashboard) {
                window.aiDashboard.onSessionCompleted({
                    duration: 45,
                    subject: "Mathematics",
                    completed: true
                });
            }
        }
    </script>
</body>
</html>
