<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dashboard - অধ্যয়ন সঙ্ঘ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 1rem;
            background-color: #f8f9fa;
        }
        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            max-width: 80%;
            position: relative;
        }
        .user-message {
            background-color: #007bff;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }
        .ai-message {
            background-color: #e9ecef;
            color: #212529;
            margin-right: auto;
            border-bottom-left-radius: 0;
        }
        .typing-indicator {
            display: none;
            padding: 0.5rem;
            background-color: #e9ecef;
            border-radius: 0.5rem;
            width: fit-content;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #6c757d;
            border-radius: 50%;
            margin-right: 2px;
            animation: typing 1s infinite;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .recommendation-card {
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            height: 100%;
        }
        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .ai-card {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .metric-card {
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        /* Skeleton loading animation */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 0.5rem;
            height: 100px;
            margin-bottom: 1rem;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand bengali-title" href="index.html">
                <i class="fas fa-graduation-cap me-2"></i>
                অধ্যয়ন সঙ্ঘ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="schedules.html">
                            <i class="fas fa-calendar-alt me-1"></i>My Schedule
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="groups.html">
                            <i class="fas fa-users me-1"></i>Study Groups
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sessions.html">
                            <i class="fas fa-clock me-1"></i>Sessions
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="ai-dashboard.html">
                            <i class="fas fa-robot me-1"></i>AI Assistant
                        </a>
                    </li>
                </ul>
                <!-- Auth Navigation -->
                <ul class="navbar-nav" id="authNav">
                    <!-- Will be populated by auth system -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Alert Messages -->
    <div class="container mt-3">
        <div id="alertContainer"></div>
    </div>

    <div class="container mt-4">
        <!-- AI Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="ai-card text-center py-5">
                    <h1><i class="fas fa-brain me-3"></i>AI Study Assistant</h1>
                    <p class="lead">Your personalized learning companion powered by artificial intelligence</p>
                </div>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="row mb-4" id="metricsContainer">
            <div class="col-md-3 mb-3">
                <div class="card metric-card text-center bg-primary text-white">
                    <div class="card-body">
                        <i class="fas fa-chart-line fa-2x mb-2"></i>
                        <h3 id="studyEfficiency">--</h3>
                        <p class="mb-0">Study Efficiency</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card text-center bg-success text-white">
                    <div class="card-body">
                        <i class="fas fa-trophy fa-2x mb-2"></i>
                        <h3 id="goalsAchieved">--</h3>
                        <p class="mb-0">Goals Achieved</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card text-center bg-info text-white">
                    <div class="card-body">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <h3 id="studyTime">--</h3>
                        <p class="mb-0">Study Time</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card metric-card text-center bg-warning text-white">
                    <div class="card-body">
                        <i class="fas fa-fire fa-2x mb-2"></i>
                        <h3 id="streak">--</h3>
                        <p class="mb-0">Day Streak</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Left Column: AI Chat -->
            <div class="col-lg-7 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-robot me-2"></i>AI Study Assistant Chat
                        </h5>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="chat-container mb-3" id="chatContainer">
                            <div class="message ai-message">
                                <p class="mb-0">Hello! I'm your AI study assistant. How can I help you today? You can ask me about:</p>
                                <ul class="mb-0 mt-2">
                                    <li>Study tips for specific subjects</li>
                                    <li>Help with difficult concepts</li>
                                    <li>Time management suggestions</li>
                                    <li>Study resource recommendations</li>
                                </ul>
                            </div>
                            <div class="typing-indicator" id="typingIndicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                        <div class="mt-auto">
                            <div class="input-group">
                                <input type="text" class="form-control" id="userInput" placeholder="Ask something about your studies...">
                                <button class="btn btn-primary" type="button" id="sendMessageBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="d-flex justify-content-around mt-3">
                                <button class="btn btn-sm btn-outline-secondary quick-question" data-question="Can you suggest study techniques for memorization?">
                                    Study techniques
                                </button>
                                <button class="btn btn-sm btn-outline-secondary quick-question" data-question="How can I improve my focus while studying?">
                                    Improve focus
                                </button>
                                <button class="btn btn-sm btn-outline-secondary quick-question" data-question="Can you recommend resources for my major?">
                                    Resources
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Personalized Recommendations -->
            <div class="col-lg-5 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>AI Recommendations
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="recommendationsContainer">
                            <!-- Will be populated by JavaScript -->
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Study Analysis Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>AI Study Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Your Learning Style: <span id="learningStyle">--</span></h5>
                                <div class="progress mb-3" style="height: 25px;">
                                    <div class="progress-bar bg-primary" id="visualBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Visual</div>
                                </div>
                                <div class="progress mb-3" style="height: 25px;">
                                    <div class="progress-bar bg-success" id="auditoryBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Auditory</div>
                                </div>
                                <div class="progress mb-3" style="height: 25px;">
                                    <div class="progress-bar bg-warning" id="kinestheticBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Kinesthetic</div>
                                </div>
                                <div class="progress mb-3" style="height: 25px;">
                                    <div class="progress-bar bg-info" id="readingBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Reading/Writing</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Best Study Times</h5>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Morning (6AM-12PM)</span>
                                    <div class="progress flex-grow-1 mx-3" style="height: 20px;">
                                        <div class="progress-bar bg-primary" id="morningBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span id="morningScore">--</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Afternoon (12PM-5PM)</span>
                                    <div class="progress flex-grow-1 mx-3" style="height: 20px;">
                                        <div class="progress-bar bg-success" id="afternoonBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span id="afternoonScore">--</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Evening (5PM-10PM)</span>
                                    <div class="progress flex-grow-1 mx-3" style="height: 20px;">
                                        <div class="progress-bar bg-warning" id="eveningBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span id="eveningScore">--</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Night (10PM-6AM)</span>
                                    <div class="progress flex-grow-1 mx-3" style="height: 20px;">
                                        <div class="progress-bar bg-danger" id="nightBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span id="nightScore">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3">
        <div class="container">
            <p class="mb-0">&copy; 2025 অধ্যয়ন সঙ্ঘ - AI-Powered Study Portal. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="global-auth.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication status - we'll allow this page to be used without login
            // but will personalize it if the user is logged in
            const isLoggedIn = StudyAuth.isLoggedIn();
            const currentUser = StudyAuth.getCurrentUser();

            // Initialize UI
            initializeChatbot();
            loadRecommendations();
            loadUserMetrics();

            // Set up event listeners
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Set up quick question buttons
            document.querySelectorAll('.quick-question').forEach(button => {
                button.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    document.getElementById('userInput').value = question;
                    sendMessage();
                });
            });

            // Chat functionality
            function sendMessage() {
                const userInput = document.getElementById('userInput');
                const message = userInput.value.trim();

                if (message === '') return;

                // Add user message to chat
                addMessageToChat(message, 'user');
                userInput.value = '';

                // Show typing indicator
                document.getElementById('typingIndicator').style.display = 'block';

                // Scroll to bottom of chat
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Simulate AI thinking
                setTimeout(() => {
                    // Hide typing indicator
                    document.getElementById('typingIndicator').style.display = 'none';

                    // Generate AI response
                    const response = generateAIResponse(message);

                    // Add AI response to chat
                    addMessageToChat(response, 'ai');

                    // Scroll to bottom of chat
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 1500);
            }

            function addMessageToChat(messageText, sender) {
                const chatContainer = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');

                if (sender === 'user') {
                    messageDiv.classList.add('user-message');
                } else {
                    messageDiv.classList.add('ai-message');
                }

                // Process message text - if it contains lists or formatted elements
                if (messageText.includes('•') || messageText.includes('-')) {
                    // Convert bullet points to proper HTML
                    const lines = messageText.split('\n');
                    let formattedMessage = '';
                    let inList = false;

                    lines.forEach(line => {
                        line = line.trim();
                        if (line.startsWith('•') || line.startsWith('-')) {
                            if (!inList) {
                                formattedMessage += '<ul class="mb-0 mt-2">';
                                inList = true;
                            }
                            formattedMessage += `<li>${line.substring(1).trim()}</li>`;
                        } else {
                            if (inList) {
                                formattedMessage += '</ul>';
                                inList = false;
                            }
                            formattedMessage += `<p class="mb-1">${line}</p>`;
                        }
                    });

                    if (inList) {
                        formattedMessage += '</ul>';
                    }

                    messageDiv.innerHTML = formattedMessage;
                } else {
                    messageDiv.innerHTML = `<p class="mb-0">${messageText}</p>`;
                }

                // Insert before typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                chatContainer.insertBefore(messageDiv, typingIndicator);
            }

            function generateAIResponse(message) {
                message = message.toLowerCase();

                // Define some response patterns based on keywords
                if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                    return `Hello${isLoggedIn ? ', ' + currentUser.name : ''}! How can I help with your studies today?`;
                }

                if (message.includes('memorization') || message.includes('memorize')) {
                    return "Here are some effective memorization techniques:\n• Spaced repetition: Review information at increasing intervals\n• Active recall: Test yourself rather than just re-reading\n• Memory palace: Visualize information in a familiar location\n• Chunking: Group information into manageable chunks\n• Create mnemonics or acronyms\n• Teach the material to someone else";
                }

                if (message.includes('focus') || message.includes('concentrate')) {
                    return "To improve your focus while studying:\n• Use the Pomodoro technique (25 min study, 5 min break)\n• Eliminate distractions - put your phone in another room\n• Create a dedicated study environment\n• Use background noise like lo-fi music or white noise\n• Stay hydrated and take short breaks\n• Try meditation before study sessions";
                }

                if (message.includes('resource') || message.includes('material')) {
                    let resources = "Here are some excellent study resources:";

                    if (isLoggedIn && currentUser.major) {
                        // Personalized recommendations based on user's major
                        if (currentUser.major === 'Computer Science') {
                            resources += "\n• Coursera - algorithms and data structures courses\n• LeetCode for coding practice\n• MIT OpenCourseWare for computer science fundamentals\n• GitHub student developer pack for free tools";
                        } else if (currentUser.major === 'Mathematics') {
                            resources += "\n• Khan Academy for clear explanations\n• 3Blue1Brown for visual understanding\n• Paul's Online Math Notes\n• MIT OpenCourseWare mathematics lectures";
                        } else if (currentUser.major === 'Biology') {
                            resources += "\n• Khan Academy's biology section\n• Crash Course Biology on YouTube\n• HHMI BioInteractive resources\n• OpenStax Biology textbook (free)";
                        } else {
                            resources += "\n• Khan Academy for foundational topics\n• Coursera for specialized courses\n• YouTube educational channels\n• OpenStax for free textbooks";
                        }
                    } else {
                        resources += "\n• Khan Academy for foundational topics\n• Coursera for specialized courses\n• YouTube educational channels\n• OpenStax for free textbooks";
                    }

                    return resources;
                }

                if (message.includes('time management') || message.includes('schedule')) {
                    return "Effective time management strategies for students:\n• Create a weekly study schedule with specific goals\n• Prioritize tasks using the Eisenhower Matrix (urgent/important)\n• Block time for difficult subjects when you're most alert\n• Use calendar apps with reminders\n• Schedule breaks and downtime\n• Set realistic goals and track your progress";
                }

                if (message.includes('motivation') || message.includes('procrastination')) {
                    return "To overcome procrastination and stay motivated:\n• Break large tasks into smaller, manageable steps\n• Use the 5-minute rule: commit to just 5 minutes of work\n• Create a reward system for completing tasks\n• Find your 'why' - connect studies to long-term goals\n• Study with friends or join a study group\n• Change your environment if you feel stuck";
                }

                // Default responses
                const defaultResponses = [
                    `I can help you with study tips, techniques, and resources${isLoggedIn ? ' personalized for ' + currentUser.major : ''}. What specific area are you struggling with?`,
                    "I'd be happy to help with your studies. Could you provide more details about what you're working on?",
                    "Great question! To give you the best advice, can you tell me which subject you're studying and what specific challenges you're facing?",
                    "I can provide study techniques, time management tips, or subject-specific advice. What would be most helpful for you right now?"
                ];

                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }

            function initializeChatbot() {
                // Add a personalized welcome message if user is logged in
                if (isLoggedIn && currentUser) {
                    // Clear the default welcome message
                    document.getElementById('chatContainer').innerHTML = '';
                    document.getElementById('typingIndicator').style.display = 'none';

                    // Add personalized welcome
                    const welcomeMessage = `Hello ${currentUser.name}! Welcome back to your AI study assistant. ${currentUser.major ? `I see you're studying ${currentUser.major}. ` : ''}How can I help you today?`;
                    addMessageToChat(welcomeMessage, 'ai');
                }
            }

            function loadRecommendations() {
                // Clear loading skeletons
                document.getElementById('recommendationsContainer').innerHTML = '';

                // Get user data for personalization
                let major = isLoggedIn && currentUser ? currentUser.major : null;
                let schedules = [];

                if (isLoggedIn) {
                    schedules = StudyAuth.loadUserData('userSchedules', []);
                }

                // Generate recommendations
                const recommendations = [];

                // Base recommendations on user's major if available
                if (major) {
                    recommendations.push({
                        title: `${major} Study Tips`,
                        description: `Personalized study strategies for ${major} students.`,
                        icon: 'lightbulb'
                    });
                }

                // Add recommendation based on study schedules if available
                if (schedules && schedules.length > 0) {
                    // Find most common subject
                    const subjects = {};
                    schedules.forEach(schedule => {
                        if (schedule.subject) {
                            subjects[schedule.subject] = (subjects[schedule.subject] || 0) + 1;
                        }
                    });

                    let topSubject = null;
                    let maxCount = 0;

                    for (const subject in subjects) {
                        if (subjects[subject] > maxCount) {
                            maxCount = subjects[subject];
                            topSubject = subject;
                        }
                    }

                    if (topSubject) {
                        recommendations.push({
                            title: `${topSubject} Resources`,
                            description: `Recommended learning materials for ${topSubject}.`,
                            icon: 'book'
                        });
                    }

                    // Check study times
                    const preferredTimes = {};
                    schedules.forEach(schedule => {
                        if (schedule.preferredTime) {
                            preferredTimes[schedule.preferredTime] = (preferredTimes[schedule.preferredTime] || 0) + 1;
                        }
                    });

                    let topTime = null;
                    maxCount = 0;

                    for (const time in preferredTimes) {
                        if (preferredTimes[time] > maxCount) {
                            maxCount = preferredTimes[time];
                            topTime = time;
                        }
                    }

                    if (topTime) {
                        const timeLabel = {
                            'morning': 'Morning',
                            'afternoon': 'Afternoon',
                            'evening': 'Evening',
                            'night': 'Night'
                        }[topTime] || topTime;

                        recommendations.push({
                            title: `${timeLabel} Study Optimization`,
                            description: `Tips to maximize your ${timeLabel.toLowerCase()} study sessions.`,
                            icon: 'clock'
                        });
                    }
                }

                // Add some default recommendations
                recommendations.push({
                    title: 'Memory Techniques',
                    description: 'Scientifically-proven methods to improve retention and recall.',
                    icon: 'brain'
                });

                recommendations.push({
                    title: 'Exam Preparation',
                    description: 'Strategies for effective test preparation and reduced anxiety.',
                    icon: 'file-alt'
                });

                recommendations.push({
                    title: 'Focus Improvement',
                    description: 'Techniques to enhance concentration during study sessions.',
                    icon: 'bullseye'
                });

                // Display recommendations
                const container = document.getElementById('recommendationsContainer');

                recommendations.slice(0, 5).forEach(rec => {
                    const card = document.createElement('div');
                    card.className = 'card recommendation-card mb-3';
                    card.innerHTML = `
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-${rec.icon} fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h5 class="card-title mb-1">${rec.title}</h5>
                                    <p class="card-text mb-0">${rec.description}</p>
                                </div>
                            </div>
                        </div>
                    `;

                    // Add click event to show recommendation details in the chat
                    card.addEventListener('click', function() {
                        document.getElementById('userInput').value = `Tell me about ${rec.title}`;
                        sendMessage();
                    });

                    container.appendChild(card);
                });
            }

            function loadUserMetrics() {
                // Default metrics for non-logged in users
                let metrics = {
                    efficiency: '65%',
                    goals: '4',
                    studyTime: '12h',
                    streak: '3'
                };

                // Learning style defaults
                let learningStyle = {
                    visual: 25,
                    auditory: 25,
                    kinesthetic: 25,
                    reading: 25,
                    primary: 'Balanced'
                };

                // Time preferences defaults
                let timePreferences = {
                    morning: 25,
                    afternoon: 25,
                    evening: 25,
                    night: 25
                };

                // If logged in, calculate personalized metrics
                if (isLoggedIn) {
                    const schedules = StudyAuth.loadUserData('userSchedules', []);

                    if (schedules && schedules.length > 0) {
                        // Calculate total study time
                        let totalMinutes = 0;
                        schedules.forEach(schedule => {
                            // For each schedule, calculate minutes per day × number of days
                            const duration = schedule.duration || 0;
                            const days = schedule.studyDays ? schedule.studyDays.length : 0;
                            totalMinutes += duration * days;
                        });

                        const totalHours = Math.round(totalMinutes / 60);
                        metrics.studyTime = `${totalHours}h`;

                        // Calculate streak (simplified simulation)
                        metrics.streak = Math.min(schedules.length * 2, 14);

                        // Calculate goals achieved (simplified)
                        metrics.goals = Math.floor(schedules.length / 2) || 1;

                        // Efficiency based on consistency
                        const efficiency = Math.min(65 + schedules.length * 5, 95);
                        metrics.efficiency = `${efficiency}%`;

                        // Calculate learning style preferences based on schedule data
                        // (In a real app, this would use actual study behavior data)
                        if (currentUser && currentUser.learningStyle) {
                            // Reset all values
                            learningStyle = {
                                visual: 10,
                                auditory: 10,
                                kinesthetic: 10,
                                reading: 10
                            };

                            // Boost the user's selected style
                            switch (currentUser.learningStyle) {
                                case 'VISUAL':
                                    learningStyle.visual = 70;
                                    learningStyle.primary = 'Visual';
                                    break;
                                case 'AUDITORY':
                                    learningStyle.auditory = 70;
                                    learningStyle.primary = 'Auditory';
                                    break;
                                case 'KINESTHETIC':
                                    learningStyle.kinesthetic = 70;
                                    learningStyle.primary = 'Kinesthetic';
                                    break;
                                case 'READING_WRITING':
                                    learningStyle.reading = 70;
                                    learningStyle.primary = 'Reading/Writing';
                                    break;
                                default:
                                    learningStyle.primary = 'Balanced';
                            }
                        }

                        // Calculate time preferences from schedules
                        const preferredTimes = {};
                        schedules.forEach(schedule => {
                            if (schedule.preferredTime) {
                                preferredTimes[schedule.preferredTime] = (preferredTimes[schedule.preferredTime] || 0) + 1;
                            }
                        });

                        // Reset time preferences
                        timePreferences = {
                            morning: 10,
                            afternoon: 10,
                            evening: 10,
                            night: 10
                        };

                        // Calculate percentages
                        const totalTimeEntries = Object.values(preferredTimes).reduce((a, b) => a + b, 0) || 1;

                        for (const time in preferredTimes) {
                            const percentage = Math.round((preferredTimes[time] / totalTimeEntries) * 60) + 10;
                            timePreferences[time] = percentage;
                        }
                    }
                }

                // Update metrics in the UI
                document.getElementById('studyEfficiency').textContent = metrics.efficiency;
                document.getElementById('goalsAchieved').textContent = metrics.goals;
                document.getElementById('studyTime').textContent = metrics.studyTime;
                document.getElementById('streak').textContent = metrics.streak;

                // Update learning style indicators
                document.getElementById('learningStyle').textContent = learningStyle.primary;
                document.getElementById('visualBar').style.width = `${learningStyle.visual}%`;
                document.getElementById('visualBar').setAttribute('aria-valuenow', learningStyle.visual);

                document.getElementById('auditoryBar').style.width = `${learningStyle.auditory}%`;
                document.getElementById('auditoryBar').setAttribute('aria-valuenow', learningStyle.auditory);

                document.getElementById('kinestheticBar').style.width = `${learningStyle.kinesthetic}%`;
                document.getElementById('kinestheticBar').setAttribute('aria-valuenow', learningStyle.kinesthetic);

                document.getElementById('readingBar').style.width = `${learningStyle.reading}%`;
                document.getElementById('readingBar').setAttribute('aria-valuenow', learningStyle.reading);

                // Update time preference indicators
                document.getElementById('morningBar').style.width = `${timePreferences.morning}%`;
                document.getElementById('morningBar').setAttribute('aria-valuenow', timePreferences.morning);
                document.getElementById('morningScore').textContent = `${timePreferences.morning}%`;

                document.getElementById('afternoonBar').style.width = `${timePreferences.afternoon}%`;
                document.getElementById('afternoonBar').setAttribute('aria-valuenow', timePreferences.afternoon);
                document.getElementById('afternoonScore').textContent = `${timePreferences.afternoon}%`;

                document.getElementById('eveningBar').style.width = `${timePreferences.evening}%`;
                document.getElementById('eveningBar').setAttribute('aria-valuenow', timePreferences.evening);
                document.getElementById('eveningScore').textContent = `${timePreferences.evening}%`;

                document.getElementById('nightBar').style.width = `${timePreferences.night}%`;
                document.getElementById('nightBar').setAttribute('aria-valuenow', timePreferences.night);
                document.getElementById('nightScore').textContent = `${timePreferences.night}%`;
            }
        });
    </script>
</body>
</html>
