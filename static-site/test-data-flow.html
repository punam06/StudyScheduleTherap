<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Test - Study Portal</title>
</head>
<body>
    <h1>Data Flow Test</h1>
    <div id="results"></div>

    <script>
        // Simulate a logged-in user
        const testUser = {
            id: "test123",
            name: "Test User",
            email: "test@example.com"
        };
        localStorage.setItem('currentUser', JSON.stringify(testUser));
        localStorage.setItem('isLoggedIn', 'true');

        // Test data storage and retrieval
        function testDataFlow() {
            const results = [];

            // Test 1: Save test group
            const testGroup = {
                id: Date.now().toString(),
                name: "Test Study Group",
                subject: "Mathematics",
                description: "Test group for math",
                status: "active",
                createdBy: testUser.id,
                members: [testUser.id]
            };

            const existingGroups = JSON.parse(localStorage.getItem(`userGroups_${testUser.id}`)) || [];
            existingGroups.push(testGroup);
            localStorage.setItem(`userGroups_${testUser.id}`, JSON.stringify(existingGroups));

            const savedGroups = JSON.parse(localStorage.getItem(`userGroups_${testUser.id}`)) || [];
            results.push(`✅ Groups Save Test: ${savedGroups.length} groups saved`);

            // Test 2: Save test session
            const testSession = {
                id: Date.now().toString() + "_session",
                title: "Test Study Session",
                subject: "Physics",
                status: "scheduled",
                duration: 60,
                createdBy: testUser.id
            };

            const existingSessions = JSON.parse(localStorage.getItem(`userSessions_${testUser.id}`)) || [];
            existingSessions.push(testSession);
            localStorage.setItem(`userSessions_${testUser.id}`, JSON.stringify(existingSessions));

            const savedSessions = JSON.parse(localStorage.getItem(`userSessions_${testUser.id}`)) || [];
            results.push(`✅ Sessions Save Test: ${savedSessions.length} sessions saved`);

            // Test 3: Save test schedule
            const testSchedule = {
                id: Date.now().toString() + "_schedule",
                title: "Test Schedule",
                subject: "Chemistry",
                status: "pending",
                duration: 120,
                createdBy: testUser.id
            };

            const existingSchedules = JSON.parse(localStorage.getItem(`userSchedules_${testUser.id}`)) || [];
            existingSchedules.push(testSchedule);
            localStorage.setItem(`userSchedules_${testUser.id}`, JSON.stringify(existingSchedules));

            const savedSchedules = JSON.parse(localStorage.getItem(`userSchedules_${testUser.id}`)) || [];
            results.push(`✅ Schedules Save Test: ${savedSchedules.length} schedules saved`);

            // Display results
            document.getElementById('results').innerHTML = `
                <h2>Data Flow Test Results:</h2>
                <ul>
                    ${results.map(result => `<li>${result}</li>`).join('')}
                </ul>
                <h3>Storage Keys Found:</h3>
                <ul>
                    ${Object.keys(localStorage).filter(key => key.includes(testUser.id)).map(key => `<li>${key}: ${JSON.parse(localStorage.getItem(key)).length} items</li>`).join('')}
                </ul>
            `;
        }

        testDataFlow();
    </script>
</body>
</html>
